{% extends "base.html" %}
{% load static %}
{% block start %}

<div class="row">
  <div class="col-lg-12">
    <div class="box-element">
      <a class="btn btn-outline-dark" href="{% url 'home' %}">&#x2190; Continue Shopping</a>
      <br />
      <br />
      {% for animal in animals %}
      <table class="table">
        <tr>
          <th>
            <h5>Items : <strong>1</strong></h5>
          </th>
          <th>
            <h5>Total : <strong>{{ animal.Animal_Prize }}</strong></h5>
          </th>
          <th>
            <a style="float: right; margin: 5px" class="btn btn-success" href="{% url 'checkout' %}">Checkout</a>
          </th>
        </tr>
      </table>
    </div>
    {% endfor %}
    <br />
    <div class="box-element">
      <div class="cart-row">
        <div style="flex: 2"></div>
        <div style="flex: 2"><strong>Item</strong></div>
        <div style="flex: 1"><strong>Price</strong></div>
        <div style="flex: 2"><strong>Quantity</strong></div>
        <div style="flex: 2"><strong>Total</strong></div>
      </div>
      {% for animal in animals %}
      <div class="cart-row" style="display: flex; justify-content: flex-start">
        <div style="flex: 2">
          <img src="{{ animal.Animal_image.url }}" class="row-image" />
        </div>
        <div style="flex: 2">{{ animal.Animal_name }}</div>
        <div style="flex: 1">{{ animal.Animal_Prize }}</div>
        <div style="flex: 2">
          <p class="quantity" id="quantity_{{ animal.id }}">X{{ animal.quantity }}</p>
          <div class="quantity">
            <img class="chg-quantity" src="{% static 'images/down.png' %}" onclick="changeQuantity('{{ animal.id }}', -1)" />
            <img class="chg-quantity" src="{% static 'images/up.png' %}" onclick="changeQuantity('{{ animal.id }}', 1)" />
          </div>
        </div>
        <div style="flex: 1" id="total_price_{{ animal.id }}">{{ animal.total_price }}</div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<script>
  function changeQuantity(animalId, change) {
    var quantityElement = document.getElementById('quantity_' + animalId);
    var totalElement = document.getElementById('total_price_' + animalId);

    if (!quantityElement || !totalElement) {
      console.error('Quantity or total price element not found');
      return;
    }

    console.log('Quantity Element Inner Text:', quantityElement.innerText); 

    var currentQuantity = parseInt(quantityElement.innerText.slice(1));
    var pricePerItem = parseFloat(totalElement.innerText);

    console.log('Current Quantity:', currentQuantity); 
    console.log('Price Per Item:', pricePerItem); 

    if (isNaN(currentQuantity)) {
      console.error('Invalid current quantity');
      return;
    }

    var newQuantity = currentQuantity + change;
    if (newQuantity < 0) {
      return;
    }
    var newTotal = pricePerItem * newQuantity;
    quantityElement.innerText = 'X' + newQuantity;
    totalElement.innerText = newTotal.toFixed(2);
  }
</script>


{% endblock %}
